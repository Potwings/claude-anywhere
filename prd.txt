# í…”ë ˆê·¸ë¨ ë´‡ ê¸°ë°˜ Claude Code í”„ë¡ì‹œ PRD

## 1. ì œí’ˆ ê°œìš”

### 1.1 ì œí’ˆëª…
Claude Code Telegram Bot

### 1.2 ëª©ì 
í…”ë ˆê·¸ë¨ ë©”ì‹ ì €ë¥¼ í†µí•´ ì§‘ PC(WSL2)ì˜ Claude Codeì— í”„ë¡¬í”„íŠ¸ë¥¼ ì „ì†¡í•˜ê³ , ì‹¤ì‹œê°„ìœ¼ë¡œ ì½”ë“œ ìƒì„± ê³¼ì •ì„ ëª¨ë‹ˆí„°ë§í•˜ë©°, ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì‹œìŠ¤í…œ

### 1.3 í•µì‹¬ ê°€ì¹˜
- ì œë¡œ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ í…”ë ˆê·¸ë¨ UI ê·¸ëŒ€ë¡œ ì‚¬ìš©
- ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥ ë´‡ ì¶”ê°€ë§Œ í•˜ë©´ ë°”ë¡œ ì‹œì‘
- í¬ë¡œìŠ¤ í”Œë«í¼ ëª¨ë°”ì¼, ë°ìŠ¤í¬í†±, ì›¹ ëª¨ë‘ ì§€ì›
- ê¸°ë³¸ ì œê³µ ê¸°ëŠ¥ í™œìš© í‘¸ì‹œ ì•Œë¦¼, íŒŒì¼ ê³µìœ , ëŒ€í™” ì´ë ¥ ë¬´ë£Œ

### 1.4 OpenClaw ì˜ê°
OpenClawì˜ í…”ë ˆê·¸ë¨ ë´‡ ë°©ì‹ì„ ë²¤ì¹˜ë§ˆí‚¹í•˜ì—¬ Claude Codeë¥¼ ëŒ€í™”í˜•ìœ¼ë¡œ ì œì–´

---

## 2. ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤

### 2.1 í•µì‹¬ ì‹œë‚˜ë¦¬ì˜¤

#### ì‹œë‚˜ë¦¬ì˜¤ 1 ì¶œê·¼ê¸¸ ì§€í•˜ì² ì—ì„œ í”„ë¡œì íŠ¸ ì‹œì‘
```
1. í…”ë ˆê·¸ë¨ì—ì„œ ë´‡ ê²€ìƒ‰ í›„ start
2. newproject blog-api ì…ë ¥
3. Spring Bootë¡œ ë¸”ë¡œê·¸ REST API ë§Œë“¤ì–´ì¤˜ ë©”ì‹œì§€ ì „ì†¡
4. ì‹¤ì‹œê°„ ë¡œê·¸ ë©”ì‹œì§€ ìˆ˜ì‹  (UserController.java ìƒì„± ì¤‘...)
5. âœ… ì‘ì—… ì™„ë£Œ! í‘¸ì‹œ ì•Œë¦¼ ë°›ìŒ
6. [ë³€ê²½ì‚¬í•­] ë²„íŠ¼ ëˆŒëŸ¬ì„œ ìƒì„±ëœ íŒŒì¼ í™•ì¸
7. íšŒì‚¬ ë„ì°©í•´ì„œ PCì—ì„œ ì½”ë“œ í™•ì¸
```

#### ì‹œë‚˜ë¦¬ì˜¤ 2 ì¹¨ëŒ€ì—ì„œ ì½”ë“œ ë¦¬ë·° í›„ ìˆ˜ì • ì§€ì‹œ
```
1. PCì—ì„œ ì½”ë“œ ë¦¬ë·° ì¤‘ ê°œì„ ì  ë°œê²¬
2. ì¹¨ëŒ€ë¡œ ì´ë™
3. í…”ë ˆê·¸ë¨ ë´‡ì— UserService ì¤‘ë³µ ì½”ë“œ ì œê±°í•´ì¤˜ ì „ì†¡
4. ì¹¨ëŒ€ì—ì„œ ë³€ê²½ ë‚´ìš© Diffë¡œ í™•ì¸
5. ë§Œì¡±í•˜ë©´ commit ëª…ë ¹ìœ¼ë¡œ ì»¤ë°‹
6. ë‹¤ìŒë‚  PR ìƒì„±
```

#### ì‹œë‚˜ë¦¬ì˜¤ 3 ì¹´í˜ì—ì„œ ê¸‰í•œ ë²„ê·¸ ìˆ˜ì •
```
1. ì¹´í˜ì—ì„œ ë²„ê·¸ ì œë³´ ë°›ìŒ
2. ë…¸íŠ¸ë¶ ì—†ì´ í…”ë ˆê·¸ë¨ë§Œìœ¼ë¡œ ëŒ€ì‘
3. NullPointerException ë²„ê·¸ ìˆ˜ì •í•´ì¤˜. 
    UserController 23ë²ˆ ë¼ì¸ ì „ì†¡
4. ìˆ˜ì • ê²°ê³¼ í™•ì¸
5. pushë¡œ ë°°í¬
```

---

## 3. ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

### 3.1 ë´‡ ëª…ë ¹ì–´ (Commands)

#### F-001 ê¸°ë³¸ ëª…ë ¹ì–´
ìš°ì„ ìˆœìœ„ P0

 ëª…ë ¹ì–´  ì„¤ëª…  ì˜ˆì‹œ 
--------------------
 start  ë´‡ ì‹œì‘ & í™˜ì˜ ë©”ì‹œì§€  `start` 
 help  ë„ì›€ë§ í‘œì‹œ  `help` 
 settings  ì„¤ì • ë©”ë‰´  `settings` 

AC
- [ ] start ì‹œ í™˜ì˜ ë©”ì‹œì§€ + ì£¼ìš” ëª…ë ¹ì–´ ì•ˆë‚´
- [ ] help ì‹œ ì „ì²´ ëª…ë ¹ì–´ ëª©ë¡ + ì‚¬ìš© ì˜ˆì‹œ
- [ ] ëª…ë ¹ì–´ëŠ” ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì•ˆ í•¨

---

#### F-002 í”„ë¡œì íŠ¸ ê´€ë¦¬ ëª…ë ¹ì–´
ìš°ì„ ìˆœìœ„ P0

 ëª…ë ¹ì–´  ì„¤ëª…  ì˜ˆì‹œ 
--------------------
 newproject  ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±  `newproject blog-api` 
 projects  í”„ë¡œì íŠ¸ ëª©ë¡ ì¡°íšŒ  `projects` 
 select  í”„ë¡œì íŠ¸ ì„ íƒ (ì»¨í…ìŠ¤íŠ¸ ì„¤ì •)  `select blog-api` 
 current  í˜„ì¬ ì„ íƒëœ í”„ë¡œì íŠ¸ í™•ì¸  `current` 
 archive  í”„ë¡œì íŠ¸ ì•„ì¹´ì´ë¸Œ  `archive blog-api` 
 delete  í”„ë¡œì íŠ¸ ì‚­ì œ  `delete blog-api` 

AC
- [ ] newproject ì‹œ workspace ë””ë ‰í† ë¦¬ ìƒì„± + Git ì´ˆê¸°í™”
- [ ] projects ì‹œ ì¸ë¼ì¸ í‚¤ë³´ë“œ ë²„íŠ¼ìœ¼ë¡œ í”„ë¡œì íŠ¸ ì„ íƒ ê°€ëŠ¥
- [ ] select í›„ í”„ë¡œì íŠ¸ê°€ ì„¸ì…˜ì— ì €ì¥ë¨ (ë‹¤ìŒ í”„ë¡¬í”„íŠ¸ì— ì‚¬ìš©)
- [ ] delete ì‹œ í™•ì¸ ë©”ì‹œì§€ í•„ìˆ˜ (ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ YES ì…ë ¥)
- [ ] í”„ë¡œì íŠ¸ëª…ì€ ì˜ë¬¸, ìˆ«ì, í•˜ì´í”ˆ(-), ì–¸ë”ìŠ¤ì½”ì–´(_)ë§Œ í—ˆìš©

---

#### F-003 ì‘ì—… ì‹¤í–‰ ëª…ë ¹ì–´
ìš°ì„ ìˆœìœ„ P0

 ëª…ë ¹ì–´  ì„¤ëª…  ì˜ˆì‹œ 
--------------------
 (ì¼ë°˜ ë©”ì‹œì§€)  í”„ë¡¬í”„íŠ¸ë¡œ ì¸ì‹í•˜ì—¬ Claude Code ì‹¤í–‰  `User API ë§Œë“¤ì–´ì¤˜` 
 status  í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì‘ì—… ìƒíƒœ  `status` 
 cancel  ì‹¤í–‰ ì¤‘ì¸ ì‘ì—… ì·¨ì†Œ  `cancel` 
 history  ìµœê·¼ ì‘ì—… ì´ë ¥ (ìµœëŒ€ 10ê°œ)  `history` 
 retry  ë§ˆì§€ë§‰ ì‹¤íŒ¨í•œ ì‘ì—… ì¬ì‹œë„  `retry` 

AC
- [ ] í”„ë¡œì íŠ¸ ì„ íƒ ì•ˆ ëœ ìƒíƒœì—ì„œ ì¼ë°˜ ë©”ì‹œì§€ ì „ì†¡ ì‹œ ê²½ê³ 
- [ ] status ì‹œ ì§„í–‰ë¥  % í‘œì‹œ (ê°€ëŠ¥í•˜ë©´)
- [ ] cancel ì‹œ ì¦‰ì‹œ í”„ë¡œì„¸ìŠ¤ kill
- [ ] history ì‹œ ê° ì‘ì—…ì— ì¸ë¼ì¸ ë²„íŠ¼ (ìƒì„¸, ì¬ì‹¤í–‰)

---

#### F-004 ê²°ê³¼ í™•ì¸ ëª…ë ¹ì–´
ìš°ì„ ìˆœìœ„ P0

 ëª…ë ¹ì–´  ì„¤ëª…  ì˜ˆì‹œ 
--------------------
 changes  ë§ˆì§€ë§‰ ì‘ì—…ì˜ ë³€ê²½ íŒŒì¼ ëª©ë¡  `changes` 
 diff  íŠ¹ì • íŒŒì¼ì˜ Diff ë³´ê¸°  `diff UserController.java` 
 show  íŒŒì¼ ì „ì²´ ë‚´ìš© ë³´ê¸°  `show UserEntity.java` 
 download  ë³€ê²½ëœ íŒŒì¼ ZIP ë‹¤ìš´ë¡œë“œ  `download` 

AC
- [ ] changes ì‹œ ìƒì„±ìˆ˜ì •ì‚­ì œ íŒŒì¼ì„ ì´ëª¨ì§€ë¡œ êµ¬ë¶„ í‘œì‹œ
- [ ] diff ì‹œ í…”ë ˆê·¸ë¨ ì½”ë“œ ë¸”ë¡ (```diff) í˜•ì‹ìœ¼ë¡œ ì „ì†¡
- [ ] show ì‹œ syntax highlighting (```java)
- [ ] download ì‹œ .zip íŒŒì¼ë¡œ í…”ë ˆê·¸ë¨ íŒŒì¼ ì „ì†¡
- [ ] íŒŒì¼ì´ ë„ˆë¬´ í¬ë©´ (5MB+) ë¶„í•  ì „ì†¡ ë˜ëŠ” ì™¸ë¶€ ë§í¬

---

#### F-005 Git ì—°ë™ ëª…ë ¹ì–´
ìš°ì„ ìˆœìœ„ P1

 ëª…ë ¹ì–´  ì„¤ëª…  ì˜ˆì‹œ 
--------------------
 commit  Git commit  `commit User API ì¶”ê°€` 
 auto_commit  ìë™ ì»¤ë°‹ ë©”ì‹œì§€ ìƒì„±  `auto_commit` 
 push  Git push  `push` 
 branch  ë¸Œëœì¹˜ ìƒì„±ë³€ê²½  `branch featureuser-api` 
 git_status  Git status í™•ì¸  `git_status` 

AC
- [ ] commit ì‹œ ë©”ì‹œì§€ ì—†ìœ¼ë©´ ì…ë ¥ ìš”ì²­
- [ ] auto_commit ì‹œ ë³€ê²½ ë‚´ìš© ê¸°ë°˜ìœ¼ë¡œ AI ì»¤ë°‹ ë©”ì‹œì§€ ìƒì„±
- [ ] push ì‹œ remote ì„¤ì • ì•ˆ ë˜ì–´ ìˆìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€
- [ ] git_status ì‹œ í˜„ì¬ ë¸Œëœì¹˜, ë³€ê²½ íŒŒì¼ ìˆ˜ í‘œì‹œ

---

### 3.2 ì¸í„°ë™í‹°ë¸Œ ë²„íŠ¼ (Inline Keyboard)

#### F-006 ì‘ì—… ì™„ë£Œ ì‹œ ì•¡ì…˜ ë²„íŠ¼
ìš°ì„ ìˆœìœ„ P0

ë²„íŠ¼ êµ¬ì„±
```
[ğŸ“„ ë³€ê²½ì‚¬í•­] [â¬‡ï¸ ë‹¤ìš´ë¡œë“œ]
[ğŸ’¾ ì»¤ë°‹] [â–¶ï¸ ê³„ì† ì‘ì—…]
```

AC
- [ ] [ë³€ê²½ì‚¬í•­] changes ìë™ ì‹¤í–‰
- [ ] [ë‹¤ìš´ë¡œë“œ] download ìë™ ì‹¤í–‰
- [ ] [ì»¤ë°‹] ì»¤ë°‹ ë©”ì‹œì§€ ì…ë ¥ í”„ë¡¬í”„íŠ¸ í‘œì‹œ
- [ ] [ê³„ì† ì‘ì—…] ì…ë ¥ì°½ í¬ì»¤ìŠ¤ (ì¶”ê°€ í”„ë¡¬í”„íŠ¸ ëŒ€ê¸°)

---

#### F-007 í”„ë¡œì íŠ¸ ëª©ë¡ ì„ íƒ ë²„íŠ¼
ìš°ì„ ìˆœìœ„ P0

ì˜ˆì‹œ
```
ğŸ“ í”„ë¡œì íŠ¸ ëª©ë¡

[blog-api] 2ì‹œê°„ ì „
[ecommerce] 1ì¼ ì „
[chatbot] 3ì¼ ì „

[+ ìƒˆ í”„ë¡œì íŠ¸]
```

AC
- [ ] ê° í”„ë¡œì íŠ¸ ë²„íŠ¼ í´ë¦­ ì‹œ ìë™ ì„ íƒ + ì‘ì—… ì‹œì‘ ì•ˆë‚´
- [ ] ìµœëŒ€ 10ê°œ í”„ë¡œì íŠ¸ í‘œì‹œ (ë” ë§ìœ¼ë©´ í˜ì´ì§•)
- [ ] [+ ìƒˆ í”„ë¡œì íŠ¸] ë²„íŠ¼ í´ë¦­ ì‹œ í”„ë¡œì íŠ¸ëª… ì…ë ¥ ìš”ì²­

---

#### F-008 íŒŒì¼ ëª©ë¡ ì„ íƒ ë²„íŠ¼
ìš°ì„ ìˆœìœ„ P1

ì˜ˆì‹œ
```
âœ… ìƒì„±ëœ íŒŒì¼

[UserController.java]
[UserService.java]
[UserEntity.java]
[UserRepository.java]

ìƒì„¸íˆ ë³¼ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.
```

AC
- [ ] ê° íŒŒì¼ ë²„íŠ¼ í´ë¦­ ì‹œ show ìë™ ì‹¤í–‰
- [ ] íŒŒì¼ì´ 10ê°œ ì´ìƒì´ë©´ ë”ë³´ê¸° ë²„íŠ¼

---

### 3.3 ì‹¤ì‹œê°„ ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë°

#### F-009 Claude Code ì‹¤í–‰ ë¡œê·¸ ì „ì†¡
ìš°ì„ ìˆœìœ„ P1

ë™ì‘
```
ì‚¬ìš©ì User API ë§Œë“¤ì–´ì¤˜

ë´‡ âš™ï¸ ì‘ì—… ì‹œì‘...
    ğŸ“ í”„ë¡œì íŠ¸ blog-api
    ğŸ†” ì‘ì—… ID #1234

ë´‡ ğŸ“ 143005 í”„ë¡œì íŠ¸ ë¶„ì„ ì¤‘...
ë´‡ ğŸ“ 143010 UserController.java ìƒì„± ì¤‘...
ë´‡ ğŸ“ 143015 UserService.java ìƒì„± ì¤‘...
ë´‡ ğŸ“ 143020 ì½”ë“œ í¬ë§·íŒ… ì ìš©...

ë´‡ âœ… ì‘ì—… ì™„ë£Œ! (30ì´ˆ ì†Œìš”)
    [ë²„íŠ¼ë“¤...]
```

AC
- [ ] ë¡œê·¸ëŠ” ê°œë³„ ë©”ì‹œì§€ë¡œ ì „ì†¡ (ë©”ì‹œì§€ ìˆ˜ì • ë°©ì‹ë„ ê³ ë ¤)
- [ ] ë¡œê·¸ ë ˆë²¨ ì´ëª¨ì§€ë¡œ êµ¬ë¶„ (ğŸ“ INFO, âš ï¸ WARN, âŒ ERROR)
- [ ] ë„ˆë¬´ ë§ì€ ë¡œê·¸ëŠ” ìš”ì•½ (ì˜ˆ íŒŒì¼ 10ê°œ ìƒì„± ì¤‘...)
- [ ] ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ ëª…í™•íˆ í‘œì‹œ

---

### 3.4 íŒŒì¼ ì „ì†¡

#### F-010 ë³€ê²½ëœ íŒŒì¼ ZIP ë‹¤ìš´ë¡œë“œ
ìš°ì„ ìˆœìœ„ P1

AC
- [ ] ëª¨ë“  ë³€ê²½ íŒŒì¼ì„ .zipìœ¼ë¡œ ì••ì¶•
- [ ] íŒŒì¼ëª… `{project_name}_changes_{task_id}.zip`
- [ ] í…”ë ˆê·¸ë¨ Document íƒ€ì…ìœ¼ë¡œ ì „ì†¡
- [ ] 50MB ì´ˆê³¼ ì‹œ ì••ì¶• ë ˆë²¨ ì¡°ì • ë˜ëŠ” ë¶„í• 

---

#### F-011 ê°œë³„ íŒŒì¼ ì „ì†¡
ìš°ì„ ìˆœìœ„ P2

AC
- [ ] íŠ¹ì • íŒŒì¼ë§Œ ì„ íƒì ìœ¼ë¡œ ì „ì†¡ ê°€ëŠ¥
- [ ] ì½”ë“œ íŒŒì¼ì€ í…ìŠ¤íŠ¸ë¡œ ì „ì†¡ (ë³µì‚¬ ìš©ì´)
- [ ] ì´ë¯¸ì§€ë°”ì´ë„ˆë¦¬ëŠ” Documentë¡œ ì „ì†¡

---

### 3.5 ì•Œë¦¼ (Notification)

#### F-012 ì‘ì—… ì™„ë£Œì‹¤íŒ¨ ì•Œë¦¼
ìš°ì„ ìˆœìœ„ P0

ì•Œë¦¼ ì‹œë‚˜ë¦¬ì˜¤
- ì‘ì—… ì™„ë£Œ âœ… User API ìƒì„± ì™„ë£Œ! 4ê°œ íŒŒì¼ ìƒì„±ë¨
- ì‘ì—… ì‹¤íŒ¨ âŒ ì‘ì—… ì‹¤íŒ¨ SyntaxError in UserController.java
- ì‘ì—… ì·¨ì†Œ ğŸš« ì‘ì—…ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤

AC
- [ ] í…”ë ˆê·¸ë¨ í‘¸ì‹œ ì•Œë¦¼ ìë™ ì „ì†¡ (ë´‡ ë©”ì‹œì§€ê°€ ê³§ ì•Œë¦¼)
- [ ] ì‚¬ìš©ìê°€ ë´‡ê³¼ ëŒ€í™” ì¤‘ì´ë©´ ì¦‰ì‹œ ë©”ì‹œì§€
- [ ] ëŒ€í™” ì•ˆ í•˜ê³  ìˆìœ¼ë©´ í‘¸ì‹œ ì•Œë¦¼ë§Œ

---

#### F-013 ì£¼ê¸°ì  ìƒíƒœ ì—…ë°ì´íŠ¸
ìš°ì„ ìˆœìœ„ P2

AC
- [ ] ì¥ì‹œê°„(5ë¶„+) ì‹¤í–‰ë˜ëŠ” ì‘ì—…ì€ 1ë¶„ë§ˆë‹¤ ì§„í–‰ ìƒí™© ì „ì†¡
- [ ] âš™ï¸ ì‘ì—… ì§„í–‰ ì¤‘... (3ë¶„ ê²½ê³¼, íŒŒì¼ 8ê°œ ìƒì„±)

---

### 3.6 ì‚¬ìš©ì ì„¤ì •

#### F-014 ê°œì¸ ì„¤ì • ê´€ë¦¬
ìš°ì„ ìˆœìœ„ P1

ì„¤ì • í•­ëª©
- ì‘ì—… íƒ€ì„ì•„ì›ƒ (ê¸°ë³¸ 10ë¶„, ìµœëŒ€ 30ë¶„)
- ìë™ ì»¤ë°‹ ì—¬ë¶€ (ê¸°ë³¸ false)
- ë¡œê·¸ ìƒì„¸ë„ (ê°„ëµìƒì„¸)
- ì•Œë¦¼ ìˆ˜ì‹  ì—¬ë¶€

UI
```
âš™ï¸ ì„¤ì •

[ì‘ì—… íƒ€ì„ì•„ì›ƒ 10ë¶„ â–¼]
[ìë™ ì»¤ë°‹ OFF â–¼]
[ë¡œê·¸ ìƒì„¸ â–¼]
[ì•Œë¦¼ ON â–¼]
```

AC
- [ ] ê° í•­ëª© í´ë¦­ ì‹œ ì˜µì…˜ ì„ íƒ ì¸ë¼ì¸ í‚¤ë³´ë“œ í‘œì‹œ
- [ ] ì„¤ì • ë³€ê²½ ì¦‰ì‹œ DB ì €ì¥
- [ ] ê¸°ë³¸ê°’ ë³µì› ë²„íŠ¼

---

### 3.7 ë©€í‹° ìœ ì € ì§€ì›

#### F-015 ì‚¬ìš©ì ì¸ì¦
ìš°ì„ ìˆœìœ„ P0

AC
- [ ] í…”ë ˆê·¸ë¨ User IDë¥¼ ê³ ìœ  ì‹ë³„ìë¡œ ì‚¬ìš©
- [ ] ìµœì´ˆ start ì‹œ ìë™ íšŒì›ê°€ì… (ë³„ë„ ê°€ì… ì ˆì°¨ ì—†ìŒ)
- [ ] user í…Œì´ë¸”ì— telegram_user_id, username, first_name ì €ì¥

---

#### F-016 ì‚¬ìš©ìë³„ ê²©ë¦¬
ìš°ì„ ìˆœìœ„ P0

AC
- [ ] ê° ì‚¬ìš©ìëŠ” ìê¸° í”„ë¡œì íŠ¸ë§Œ ì¡°íšŒìˆ˜ì • ê°€ëŠ¥
- [ ] workspace ê²½ë¡œ `homepotwingsworkspace{telegram_user_id}{project_name}`
- [ ] DB ì¿¼ë¦¬ì— í•­ìƒ user_id ì¡°ê±´ í¬í•¨

---

### 3.8 ì—ëŸ¬ ì²˜ë¦¬

#### F-017 ì¹œì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€
ìš°ì„ ìˆœìœ„ P0

ì—ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ë³„ ë©”ì‹œì§€

 ì—ëŸ¬  ë©”ì‹œì§€ 
--------------
 í”„ë¡œì íŠ¸ ë¯¸ì„ íƒ  âš ï¸ ë¨¼ì € í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”. projects 
 í”„ë¡œì íŠ¸ëª… ì¤‘ë³µ  âš ï¸ ê°™ì€ ì´ë¦„ì˜ í”„ë¡œì íŠ¸ê°€ ì´ë¯¸ ìˆì–´ìš”. ë‹¤ë¥¸ ì´ë¦„ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”. 
 Claude Code íƒ€ì„ì•„ì›ƒ  â±ï¸ ì‘ì—…ì´ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë ¤ì„œ ì¤‘ë‹¨í–ˆì–´ìš”. retryë¡œ ì¬ì‹œë„í•˜ê±°ë‚˜ ë” ê°„ë‹¨í•œ ìš”ì²­ìœ¼ë¡œ ë‚˜ëˆ ë³´ì„¸ìš”. 
 ë””ìŠ¤í¬ ìš©ëŸ‰ ë¶€ì¡±  ğŸ’¾ ë””ìŠ¤í¬ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ë¶ˆí•„ìš”í•œ í”„ë¡œì íŠ¸ë¥¼ ì‚­ì œí•´ì£¼ì„¸ìš”. 
 WSL2 ì„œë²„ ë‹¤ìš´  ğŸ”´ ì„œë²„ ì—°ê²°ì´ ëŠì–´ì¡Œì–´ìš”. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”. 

AC
- [ ] ëª¨ë“  ì—ëŸ¬ì— ì´ëª¨ì§€ + í•´ê²° ë°©ë²• í¬í•¨
- [ ] ê¸°ìˆ ì  ì—ëŸ¬ ìŠ¤íƒì€ ìˆ¨ê¸°ê³  ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€ë§Œ í‘œì‹œ
- [ ] ì‹¬ê°í•œ ì—ëŸ¬ëŠ” ê´€ë¦¬ìì—ê²Œ ë³„ë„ ì•Œë¦¼

---

## 4. ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

### 4.1 ì„±ëŠ¥

#### NF-001 ì‘ë‹µ ì‹œê°„
- ëª…ë ¹ì–´ ì²˜ë¦¬  1ì´ˆ
- ì‘ì—… ì‹œì‘ ì‘ë‹µ  2ì´ˆ
- ë¡œê·¸ ë©”ì‹œì§€ ì „ì†¡  500ms
- íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì¤€ë¹„  5ì´ˆ

#### NF-002 ë™ì‹œ ì²˜ë¦¬
- ì‚¬ìš©ìë³„ ë™ì‹œ ìµœëŒ€ 1ê°œ ì‘ì—… (ìˆœì°¨ ì²˜ë¦¬)
- ì—¬ëŸ¬ ì‚¬ìš©ì ë™ì‹œ ì‚¬ìš© ê°€ëŠ¥ (ìµœëŒ€ 5ëª…)
- ëŒ€ê¸°ì—´ ìµœëŒ€ 3ê°œ ì‘ì—…

---

### 4.2 ë³´ì•ˆ

#### NF-003 ë´‡ í† í° ë³´ì•ˆ
- í™˜ê²½ë³€ìˆ˜ ë˜ëŠ” secrets íŒŒì¼ë¡œ ê´€ë¦¬
- GitHubì— ì ˆëŒ€ ì»¤ë°‹ ê¸ˆì§€
- ì£¼ê¸°ì  í† í° ê°±ì‹  ê¶Œì¥

#### NF-004 ì‚¬ìš©ì ê¶Œí•œ
- Telegram User ID ê¸°ë°˜ ì¸ì¦
- ë‹¤ë¥¸ ì‚¬ìš©ì í”„ë¡œì íŠ¸ ì ‘ê·¼ ì°¨ë‹¨
- íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼ ì œí•œ (workspace ë‚´ë¶€ë§Œ)

#### NF-005 ëª…ë ¹ ì¸ì ì…˜ ë°©ì§€
- í”„ë¡œì íŠ¸ëª…, íŒŒì¼ëª…ì— íŠ¹ìˆ˜ë¬¸ì í•„í„°ë§
- Git ëª…ë ¹ì–´ íŒŒë¼ë¯¸í„° sanitize
- Shell ëª…ë ¹ì–´ ì§ì ‘ ì‹¤í–‰ ê¸ˆì§€ (í—ˆìš© ëª©ë¡ ë°©ì‹)

---

### 4.3 ì•ˆì •ì„±

#### NF-006 ì¥ì•  ë³µêµ¬
- WSL2 ì„œë²„ ë‹¤ìš´ ì‹œ ìë™ ì¬ì‹œì‘
- ì‘ì—… ì§„í–‰ ì¤‘ ë´‡ ì¬ì‹œì‘ ì‹œ ìƒíƒœ ë³µêµ¬
- ì‹¤íŒ¨í•œ ì‘ì—… ìë™ ì¬ì‹œë„ ì˜µì…˜

#### NF-007 ë¡œê¹…
- ëª¨ë“  ëª…ë ¹ì–´ ì‹¤í–‰ ë¡œê·¸ ê¸°ë¡
- ì—ëŸ¬ ë°œìƒ ì‹œ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ íŒŒì¼ ì €ì¥
- ì¼ì¼ ì‚¬ìš© í†µê³„ (ëª…ë ¹ì–´ë³„, ì‚¬ìš©ìë³„)

---

### 4.4 ì‚¬ìš©ì„±

#### NF-008 í…”ë ˆê·¸ë¨ UX ìµœì í™”
- ê¸´ ë©”ì‹œì§€ëŠ” ì—¬ëŸ¬ ë©”ì‹œì§€ë¡œ ë¶„í•  (4096ì ì œí•œ)
- ì½”ë“œ ë¸”ë¡ì€ ```ì–¸ì–´ëª… í˜•ì‹ ì‚¬ìš©
- ì¸ë¼ì¸ í‚¤ë³´ë“œ ì ê·¹ í™œìš©
- ì´ëª¨ì§€ë¡œ ê°€ë…ì„± í–¥ìƒ

#### NF-009 ì˜¤í”„ë¼ì¸ ì§€ì›
- í…”ë ˆê·¸ë¨ ìì²´ê°€ ì˜¤í”„ë¼ì¸ ë©”ì‹œì§€ íì‰ ì§€ì›
- ì„œë²„ ë³µêµ¬ í›„ ëŒ€ê¸° ì¤‘ì¸ ëª…ë ¹ì–´ ìˆœì°¨ ì²˜ë¦¬

---

## 5. ê¸°ìˆ  ìŠ¤íƒ

### 5.1 ë°±ì—”ë“œ (WSL2 Ubuntu)

```yaml
Framework: Spring Boot 3.5.9
Language: Java 21 LTS
Database: MySQL 8.0
ORM: MyBatis 3.5.19 + MyBatis Spring Boot Starter 3.0.4
Telegram API: TelegramBots 9.2.1 (Long Polling Starter)
Process Management: ProcessBuilder + Virtual Threads
Version Control: JGit 6.10+
Connection Pool: HikariCP (Spring Boot ê¸°ë³¸ ë‚´ì¥)
JSON Processing: Jackson 2.17+
Logging: SLF4J + Logback
```

### 5.2 ì˜ì¡´ì„± ì„¤ì • (Maven)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
         https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.5.9</version>
        <relativePath/>
    </parent>

    <groupId>com.potwings</groupId>
    <artifactId>claude-code-telegram-bot</artifactId>
    <version>1.0.0</version>
    <name>Claude Code Telegram Bot</name>

    <properties>
        <java.version>21</java.version>
        <mybatis-spring-boot.version>3.0.4</mybatis-spring-boot.version>
        <telegrambots.version>9.2.1</telegrambots.version>
        <jgit.version>6.10.0.202406032230-r</jgit.version>
    </properties>

    <dependencies>
        <!-- Spring Boot Starters -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-validation</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>

        <!-- MyBatis -->
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>${mybatis-spring-boot.version}</version>
        </dependency>

        <!-- Telegram Bots -->
        <dependency>
            <groupId>org.telegram</groupId>
            <artifactId>telegrambots-springboot-longpolling-starter</artifactId>
            <version>${telegrambots.version}</version>
        </dependency>

        <!-- Database -->
        <dependency>
            <groupId>com.mysql</groupId>
            <artifactId>mysql-connector-j</artifactId>
            <scope>runtime</scope>
        </dependency>

        <!-- JGit for Git operations -->
        <dependency>
            <groupId>org.eclipse.jgit</groupId>
            <artifactId>org.eclipse.jgit</artifactId>
            <version>${jgit.version}</version>
        </dependency>

        <!-- Utilities -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>

        <!-- Testing -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter-test</artifactId>
            <version>${mybatis-spring-boot.version}</version>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>
```

### 5.3 ì¸í”„ë¼

```yaml
OS: WSL2 Ubuntu 24.04 LTS
Bot Hosting: WSL2 (Long Polling ë°©ì‹)
Network: Tailscale VPN (ì„ íƒ, ì™¸ë¶€ ì ‘ì†ìš©)
Reverse Proxy: ë¶ˆí•„ìš” (í…”ë ˆê·¸ë¨ API ì§ì ‘ í†µì‹ )
Process Supervisor: systemd (ìë™ ì¬ì‹œì‘)
Monitoring: Spring Boot Actuator + Prometheus (ì„ íƒ)
```

### 5.4 ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • (application.yml)

```yaml
spring:
  application:
    name: claude-code-telegram-bot

  datasource:
    url: jdbc:mysql://localhost:3306/claude_bot?useSSL=false&serverTimezone=Asia/Seoul&characterEncoding=UTF-8
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      idle-timeout: 300000
      connection-timeout: 20000

  threads:
    virtual:
      enabled: true  # Java 21 Virtual Threads í™œì„±í™”

mybatis:
  mapper-locations: classpath:mapper/**/*.xml
  type-aliases-package: com.potwings.claudebot.domain
  configuration:
    map-underscore-to-camel-case: true
    default-fetch-size: 100
    default-statement-timeout: 30

telegram:
  bot:
    token: ${TELEGRAM_BOT_TOKEN}
    username: ${TELEGRAM_BOT_USERNAME}

claude:
  workspace:
    base-path: /home/potwings/workspace
  timeout:
    default-minutes: 10
    max-minutes: 30

logging:
  level:
    com.potwings.claudebot: DEBUG
    org.telegram: INFO
  file:
    name: logs/claude-bot.log
    max-size: 10MB
    max-history: 30

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when_authorized
```

### 5.5 í”„ë¡œì íŠ¸ êµ¬ì¡°

```
claude-code-telegram-bot/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/com/potwings/claudebot/
â”‚   â”‚   â”‚   â”œâ”€â”€ ClaudeCodeTelegramBotApplication.java
â”‚   â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TelegramBotConfig.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AsyncConfig.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SecurityConfig.java
â”‚   â”‚   â”‚   â”œâ”€â”€ bot/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ClaudeCodeBot.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ command/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CommandRouter.java
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ StartCommand.java
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ HelpCommand.java
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectCommand.java
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ GitCommand.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ callback/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ CallbackHandler.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ keyboard/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ InlineKeyboardFactory.java
â”‚   â”‚   â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserService.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectService.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TaskService.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SessionService.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ClaudeCodeService.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ GitService.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileService.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ NotificationService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ User.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Project.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Task.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileChange.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserSession.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ UserSettings.java
â”‚   â”‚   â”‚   â”œâ”€â”€ mapper/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserMapper.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectMapper.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TaskMapper.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FileChangeMapper.java
â”‚   â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ request/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ response/
â”‚   â”‚   â”‚   â”œâ”€â”€ exception/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BotException.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectNotFoundException.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ GlobalExceptionHandler.java
â”‚   â”‚   â”‚   â””â”€â”€ util/
â”‚   â”‚   â”‚       â”œâ”€â”€ MessageFormatter.java
â”‚   â”‚   â”‚       â”œâ”€â”€ CommandParser.java
â”‚   â”‚   â”‚       â””â”€â”€ FileUtils.java
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ application.yml
â”‚   â”‚       â”œâ”€â”€ application-dev.yml
â”‚   â”‚       â”œâ”€â”€ application-prod.yml
â”‚   â”‚       â”œâ”€â”€ mapper/
â”‚   â”‚       â”‚   â”œâ”€â”€ UserMapper.xml
â”‚   â”‚       â”‚   â”œâ”€â”€ ProjectMapper.xml
â”‚   â”‚       â”‚   â””â”€â”€ TaskMapper.xml
â”‚   â”‚       â””â”€â”€ messages/
â”‚   â”‚           â”œâ”€â”€ messages_ko.properties
â”‚   â”‚           â””â”€â”€ messages_en.properties
â”‚   â””â”€â”€ test/
â”‚       â””â”€â”€ java/com/potwings/claudebot/
â”‚           â”œâ”€â”€ service/
â”‚           â””â”€â”€ bot/
â”œâ”€â”€ logs/
â”œâ”€â”€ pom.xml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md
```

---

## 6. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### 6.1 í•µì‹¬ í…Œì´ë¸”

```sql
-- User
CREATE TABLE user (
    user_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    telegram_user_id BIGINT NOT NULL UNIQUE,
    username VARCHAR(255),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    last_active_at DATETIME,
    INDEX idx_telegram_user_id (telegram_user_id)
);

-- Project
CREATE TABLE project (
    project_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    project_name VARCHAR(255) NOT NULL,
    workspace_path VARCHAR(500) NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_archived BOOLEAN NOT NULL DEFAULT FALSE,
    FOREIGN KEY (user_id) REFERENCES user(user_id),
    UNIQUE KEY uk_user_project (user_id, project_name),
    INDEX idx_user_active (user_id, is_archived)
);

-- Task
CREATE TABLE task (
    task_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    project_id BIGINT NOT NULL,
    task_uuid VARCHAR(36) NOT NULL UNIQUE,
    prompt TEXT NOT NULL,
    status ENUM('QUEUED', 'RUNNING', 'COMPLETED', 'FAILED', 'CANCELLED') NOT NULL,
    queued_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    started_at DATETIME,
    completed_at DATETIME,
    duration_seconds INT,
    error_message TEXT,
    files_created INT DEFAULT 0,
    files_modified INT DEFAULT 0,
    files_deleted INT DEFAULT 0,
    total_lines INT DEFAULT 0,
    FOREIGN KEY (user_id) REFERENCES user(user_id),
    FOREIGN KEY (project_id) REFERENCES project(project_id),
    INDEX idx_user_task (user_id, status),
    INDEX idx_project_task (project_id)
);

-- File_Change
CREATE TABLE file_change (
    change_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    task_id BIGINT NOT NULL,
    file_path VARCHAR(1000) NOT NULL,
    change_type ENUM('CREATED', 'MODIFIED', 'DELETED') NOT NULL,
    lines_added INT DEFAULT 0,
    lines_removed INT DEFAULT 0,
    diff_content MEDIUMTEXT,
    file_content MEDIUMTEXT,
    FOREIGN KEY (task_id) REFERENCES task(task_id),
    INDEX idx_task_changes (task_id)
);

-- User_Session (í˜„ì¬ ì„ íƒëœ í”„ë¡œì íŠ¸ ì¶”ì )
CREATE TABLE user_session (
    session_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL UNIQUE,
    current_project_id BIGINT,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES user(user_id),
    FOREIGN KEY (current_project_id) REFERENCES project(project_id)
);

-- User_Settings
CREATE TABLE user_settings (
    settings_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL UNIQUE,
    task_timeout_minutes INT DEFAULT 10,
    auto_commit BOOLEAN DEFAULT FALSE,
    log_level ENUM('brief', 'verbose') DEFAULT 'brief',
    notification_enabled BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (user_id) REFERENCES user(user_id)
);
```

---

## 7. API íë¦„ë„

### 7.1 ëª…ë ¹ì–´ ì²˜ë¦¬ íë¦„

```
[í…”ë ˆê·¸ë¨ ì‚¬ìš©ì]
    â†“ ë©”ì‹œì§€ ì „ì†¡
[Telegram API]
    â†“ Webhook or Long Polling
[Spring Boot - TelegramBot Handler]
    â†“ ëª…ë ¹ì–´ íŒŒì‹±
[CommandRouter]
    â”œâ”€ newproject â†’ ProjectService
    â”œâ”€ select â†’ SessionService
    â”œâ”€ ì¼ë°˜ ë©”ì‹œì§€ â†’ ClaudeCodeService
    â””â”€ commit â†’ GitService
    â†“
[Service Layer ì‹¤í–‰]
    â†“
[í…”ë ˆê·¸ë¨ ì‘ë‹µ ì „ì†¡]
    â†“
[ì‚¬ìš©ìì—ê²Œ ë©”ì‹œì§€ ë„ì°©]
```

### 7.2 í”„ë¡¬í”„íŠ¸ ì‹¤í–‰ íë¦„

```
[ì‚¬ìš©ì] User API ë§Œë“¤ì–´ì¤˜
    â†“
[BotHandler] 
    - í”„ë¡œì íŠ¸ ì„ íƒ í™•ì¸
    - Task ìƒì„± (QUEUED)
    â†“
[ClaudeCodeService]
    - âš™ï¸ ì‘ì—… ì‹œì‘... ë©”ì‹œì§€ ì „ì†¡
    - ExecutorServiceë¡œ ë¹„ë™ê¸° ì‹¤í–‰
    â†“
[ProcessBuilder]
    - Claude Code CLI ì‹¤í–‰
    - stdout ìŠ¤íŠ¸ë¦¼ ì½ê¸°
    â†“
[LogStreamHandler]
    - ê° ë¡œê·¸ ë¼ì¸ë§ˆë‹¤ í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡
    â†“
[Task ì™„ë£Œ]
    - file_change í…Œì´ë¸” ì €ì¥
    - âœ… ì‘ì—… ì™„ë£Œ! ë©”ì‹œì§€ + ì¸ë¼ì¸ ë²„íŠ¼
```

---

## 8. ê°œë°œ ìš°ì„ ìˆœìœ„

### Phase 1 ê¸°ë³¸ ë´‡ êµ¬ì¶• (3ì¼)
- [ ] F-001 ê¸°ë³¸ ëª…ë ¹ì–´ (start, help)
- [ ] F-002 í”„ë¡œì íŠ¸ ê´€ë¦¬ (newproject, projects, select)
- [ ] F-015 ì‚¬ìš©ì ì¸ì¦ (Telegram ID)
- [ ] DB ìŠ¤í‚¤ë§ˆ ìƒì„±

### Phase 2 ì½”ì–´ ê¸°ëŠ¥ (3ì¼)
- [ ] F-003 í”„ë¡¬í”„íŠ¸ ì‹¤í–‰ (ì¼ë°˜ ë©”ì‹œì§€ â†’ Claude Code)
- [ ] F-009 ì‹¤ì‹œê°„ ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë°
- [ ] F-004 ê²°ê³¼ í™•ì¸ (changes, diff)
- [ ] F-006 ì‘ì—… ì™„ë£Œ ì¸ë¼ì¸ ë²„íŠ¼

### Phase 3 Git ì—°ë™ (2ì¼)
- [ ] F-005 Git ëª…ë ¹ì–´ (commit, push, git_status)
- [ ] auto_commit (AI ì»¤ë°‹ ë©”ì‹œì§€ ìƒì„±)

### Phase 4 í¸ì˜ ê¸°ëŠ¥ (2ì¼)
- [ ] F-007 í”„ë¡œì íŠ¸ ëª©ë¡ ì¸ë¼ì¸ ë²„íŠ¼
- [ ] F-010 ZIP ë‹¤ìš´ë¡œë“œ
- [ ] F-014 ì‚¬ìš©ì ì„¤ì •
- [ ] F-013 ì£¼ê¸°ì  ìƒíƒœ ì—…ë°ì´íŠ¸

### Phase 5 í´ë¦¬ì‹± (1ì¼)
- [ ] F-017 ì¹œì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€
- [ ] ì´ëª¨ì§€ ìµœì í™”
- [ ] ë©”ì‹œì§€ í¬ë§·íŒ… ê°œì„ 
- [ ] ë„ì›€ë§ ë¬¸ì„œ ì‘ì„±

ì´ ê°œë°œ ê¸°ê°„ ì•½ 11ì¼ (2ì£¼ ì´ë‚´)

---

## 9. ì„±ê³µ ì§€í‘œ (KPI)

### 9.1 ì‚¬ìš©ì„±
- ëª©í‘œ ì²« í”„ë¡¬í”„íŠ¸ ì „ì†¡ê¹Œì§€  1ë¶„
- ì¸¡ì • start â†’ newproject â†’ ì²« ë©”ì‹œì§€

### 9.2 ì„±ëŠ¥
- ëª©í‘œ ì‘ì—… ì„±ê³µë¥   90%
- ì¸¡ì • COMPLETED  (COMPLETED + FAILED)

### 9.3 ë§Œì¡±ë„
- ëª©í‘œ ì¼ì£¼ì¼ í›„ì—ë„ ê³„ì† ì‚¬ìš©
- ì¸¡ì • Daily Active Users (DAU)

---

## 10. ë¦¬ìŠ¤í¬ & ëŒ€ì‘

 ë¦¬ìŠ¤í¬  ì˜í–¥  í™•ë¥   ëŒ€ì‘ ë°©ì•ˆ 
-------------------------------
 í…”ë ˆê·¸ë¨ API ì œí•œ (ì´ˆë‹¹ 30msg)  ì¤‘ê°„  ë‚®ìŒ  ë©”ì‹œì§€ íì‰ + ë³‘í•© ì „ì†¡ 
 Claude Code ê¸´ ì‹¤í–‰ ì‹œê°„  ë†’ìŒ  ë†’ìŒ  íƒ€ì„ì•„ì›ƒ ì„¤ì • + ì£¼ê¸° ì—…ë°ì´íŠ¸ 
 WSL2 ì„œë²„ ë‹¤ìš´  ë†’ìŒ  ì¤‘ê°„  Health Check + ìë™ ì¬ì‹œì‘ 
 í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ í¬ê¸° ì œí•œ (4096ì)  ë‚®ìŒ  ë†’ìŒ  ìë™ ë¶„í•  ì „ì†¡ 
 ì—¬ëŸ¬ ì‚¬ìš©ì ë™ì‹œ ì‘ì—… ì‹œ ë¦¬ì†ŒìŠ¤  ì¤‘ê°„  ë‚®ìŒ  í ê´€ë¦¬ + ë™ì‹œ ì‘ì—… ì œí•œ 

---

## 11. ì»¤ìŠ¤í…€ ì•± vs í…”ë ˆê·¸ë¨ ë´‡ ë¹„êµ

 í•­ëª©  ì»¤ìŠ¤í…€ ëª¨ë°”ì¼ ì•±  í…”ë ˆê·¸ë¨ ë´‡ 
------------------------------------
 ê°œë°œ ê¸°ê°„  5ì£¼  2ì£¼ 
 í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ  í•„ìš” (Android + iOS)  ë¶ˆí•„ìš” âœ… 
 í‘¸ì‹œ ì•Œë¦¼  FCM êµ¬í˜„ í•„ìš”  ê¸°ë³¸ ì œê³µ âœ… 
 í¬ë¡œìŠ¤ í”Œë«í¼  ê°ê° ê°œë°œ  ìë™ ì§€ì› âœ… 
 ëŒ€í™” ì´ë ¥  DB + UI êµ¬í˜„  í…”ë ˆê·¸ë¨ ìì²´ âœ… 
 íŒŒì¼ ê³µìœ   ì—…ë¡œë“œ êµ¬í˜„  ê¸°ë³¸ ì œê³µ âœ… 
 ì¸ì¦  JWT êµ¬í˜„  Telegram ID âœ… 
 UI ì»¤ìŠ¤í„°ë§ˆì´ì§•  ììœ ë¡œì›€  ì œí•œì  âš ï¸ 
 ì•± ë°°í¬  ìŠ¤í† ì–´ ì‹¬ì‚¬ í•„ìš”  ì¦‰ì‹œ ì‚¬ìš© âœ… 
 ìœ ì§€ë³´ìˆ˜  ë³µì¡  ê°„ë‹¨ âœ… 

ê²°ë¡  í…”ë ˆê·¸ë¨ ë´‡ì´ ì••ë„ì ìœ¼ë¡œ ìœ ë¦¬í•©ë‹ˆë‹¤!

---

---

## 12. í•µì‹¬ ì½”ë“œ ìƒ˜í”Œ

### 12.1 TelegramBot ë©”ì¸ í´ë˜ìŠ¤

```java
package com.potwings.claudebot.bot;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;
import org.telegram.telegrambots.client.okhttp.OkHttpTelegramClient;
import org.telegram.telegrambots.longpolling.interfaces.LongPollingUpdateConsumer;
import org.telegram.telegrambots.meta.api.methods.send.SendMessage;
import org.telegram.telegrambots.meta.api.objects.Update;
import org.telegram.telegrambots.meta.exceptions.TelegramApiException;
import org.telegram.telegrambots.meta.generics.TelegramClient;

import java.util.List;

@Component
public class ClaudeCodeBot implements LongPollingUpdateConsumer {

    private final TelegramClient telegramClient;
    private final CommandRouter commandRouter;

    public ClaudeCodeBot(
            @Value("${telegram.bot.token}") String botToken,
            CommandRouter commandRouter) {
        this.telegramClient = new OkHttpTelegramClient(botToken);
        this.commandRouter = commandRouter;
    }

    @Override
    public void consume(List<Update> updates) {
        updates.forEach(this::processUpdate);
    }

    private void processUpdate(Update update) {
        if (update.hasMessage() && update.getMessage().hasText()) {
            commandRouter.route(update, telegramClient);
        } else if (update.hasCallbackQuery()) {
            commandRouter.handleCallback(update.getCallbackQuery(), telegramClient);
        }
    }

    public void sendMessage(Long chatId, String text) {
        SendMessage message = SendMessage.builder()
                .chatId(chatId)
                .text(text)
                .parseMode("Markdown")
                .build();
        try {
            telegramClient.execute(message);
        } catch (TelegramApiException e) {
            // ì—ëŸ¬ ì²˜ë¦¬
        }
    }
}
```

### 12.2 Claude Code ì‹¤í–‰ ì„œë¹„ìŠ¤ (Virtual Threads í™œìš©)

```java
package com.potwings.claudebot.service;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.nio.file.Path;
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.function.Consumer;

@Slf4j
@Service
@RequiredArgsConstructor
public class ClaudeCodeService {

    @Value("${claude.workspace.base-path}")
    private String workspaceBasePath;

    @Value("${claude.timeout.default-minutes}")
    private int defaultTimeoutMinutes;

    // Java 21 Virtual Threads ì‚¬ìš©
    private final ExecutorService executor = Executors.newVirtualThreadPerTaskExecutor();

    public CompletableFuture<TaskResult> executePrompt(
            String projectPath,
            String prompt,
            Consumer<String> logCallback) {

        return CompletableFuture.supplyAsync(() -> {
            try {
                ProcessBuilder pb = new ProcessBuilder(
                        "claude",
                        "--dangerously-skip-permissions",
                        "-p", prompt
                );
                pb.directory(Path.of(workspaceBasePath, projectPath).toFile());
                pb.redirectErrorStream(true);

                Process process = pb.start();

                // ì‹¤ì‹œê°„ ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë°
                try (BufferedReader reader = new BufferedReader(
                        new InputStreamReader(process.getInputStream()))) {
                    String line;
                    while ((line = reader.readLine()) != null) {
                        logCallback.accept(line);
                    }
                }

                int exitCode = process.waitFor();
                return new TaskResult(exitCode == 0, exitCode);

            } catch (Exception e) {
                log.error("Claude Code ì‹¤í–‰ ì‹¤íŒ¨", e);
                return new TaskResult(false, -1, e.getMessage());
            }
        }, executor);
    }

    public record TaskResult(boolean success, int exitCode, String errorMessage) {
        public TaskResult(boolean success, int exitCode) {
            this(success, exitCode, null);
        }
    }
}
```

### 12.3 ì¸ë¼ì¸ í‚¤ë³´ë“œ íŒ©í† ë¦¬

```java
package com.potwings.claudebot.bot.keyboard;

import org.telegram.telegrambots.meta.api.objects.replykeyboard.InlineKeyboardMarkup;
import org.telegram.telegrambots.meta.api.objects.replykeyboard.buttons.InlineKeyboardButton;
import org.telegram.telegrambots.meta.api.objects.replykeyboard.buttons.InlineKeyboardRow;

import java.util.ArrayList;
import java.util.List;

public class InlineKeyboardFactory {

    public static InlineKeyboardMarkup taskCompleteKeyboard(Long taskId) {
        return InlineKeyboardMarkup.builder()
                .keyboardRow(new InlineKeyboardRow(
                        InlineKeyboardButton.builder()
                                .text("ğŸ“„ ë³€ê²½ì‚¬í•­")
                                .callbackData("changes:" + taskId)
                                .build(),
                        InlineKeyboardButton.builder()
                                .text("â¬‡ï¸ ë‹¤ìš´ë¡œë“œ")
                                .callbackData("download:" + taskId)
                                .build()
                ))
                .keyboardRow(new InlineKeyboardRow(
                        InlineKeyboardButton.builder()
                                .text("ğŸ’¾ ì»¤ë°‹")
                                .callbackData("commit:" + taskId)
                                .build(),
                        InlineKeyboardButton.builder()
                                .text("â–¶ï¸ ê³„ì† ì‘ì—…")
                                .callbackData("continue:" + taskId)
                                .build()
                ))
                .build();
    }

    public static InlineKeyboardMarkup projectListKeyboard(List<Project> projects) {
        List<InlineKeyboardRow> rows = new ArrayList<>();

        for (Project project : projects) {
            rows.add(new InlineKeyboardRow(
                    InlineKeyboardButton.builder()
                            .text("ğŸ“ " + project.getProjectName())
                            .callbackData("select:" + project.getProjectId())
                            .build()
            ));
        }

        rows.add(new InlineKeyboardRow(
                InlineKeyboardButton.builder()
                        .text("â• ìƒˆ í”„ë¡œì íŠ¸")
                        .callbackData("newproject")
                        .build()
        ));

        return InlineKeyboardMarkup.builder()
                .keyboard(rows)
                .build();
    }
}
```

---

## 13. ì¶”ê°€ ê°œì„  ì‚¬í•­

### 13.1 ì„±ëŠ¥ ìµœì í™”

| í•­ëª© | ê°œì„  ë‚´ìš© |
|------|----------|
| Virtual Threads | Java 21 Virtual Threadsë¡œ ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ íš¨ìœ¨ ê·¹ëŒ€í™” |
| ë©”ì‹œì§€ ë°°ì¹˜ ì „ì†¡ | ì§§ì€ ê°„ê²©ì˜ ë¡œê·¸ë¥¼ ëª¨ì•„ì„œ ì „ì†¡ (Rate Limit íšŒí”¼) |
| ì»¤ë„¥ì…˜ í’€ë§ | HikariCP ìµœì í™” ì„¤ì • |
| ìºì‹± | ì‚¬ìš©ì ì„¸ì…˜ ë° í”„ë¡œì íŠ¸ ì •ë³´ ë©”ëª¨ë¦¬ ìºì‹± |

### 13.2 ë³´ì•ˆ ê°•í™”

| í•­ëª© | êµ¬í˜„ ë°©ì•ˆ |
|------|----------|
| í† í° ê´€ë¦¬ | í™˜ê²½ë³€ìˆ˜ + Spring @Value ì£¼ì… |
| ì…ë ¥ ê²€ì¦ | Bean Validation (@Valid, @Pattern) |
| ëª…ë ¹ ì¸ì ì…˜ ë°©ì§€ | í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ë°©ì‹ + ProcessBuilder ì‚¬ìš© |
| íŒŒì¼ ê²½ë¡œ ê²€ì¦ | Path Traversal ê³µê²© ë°©ì§€ |
| Rate Limiting | ì‚¬ìš©ìë³„ ë¶„ë‹¹ ìš”ì²­ ìˆ˜ ì œí•œ |

### 13.3 ìš´ì˜ í¸ì˜

| í•­ëª© | êµ¬í˜„ ë°©ì•ˆ |
|------|----------|
| Health Check | Spring Actuator `/health` ì—”ë“œí¬ì¸íŠ¸ |
| ë¡œê·¸ ê´€ë¦¬ | Logback íŒŒì¼ ë¡¤ë§ + 30ì¼ ë³´ê´€ |
| ìë™ ì¬ì‹œì‘ | systemd ì„œë¹„ìŠ¤ ë“±ë¡ |
| ëª¨ë‹ˆí„°ë§ | Actuator ë©”íŠ¸ë¦­ + Prometheus (ì„ íƒ) |

### 13.4 ë‹¤êµ­ì–´ ì§€ì›

```properties
# messages_ko.properties
bot.welcome=ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”! Claude Code Botì…ë‹ˆë‹¤.
bot.help=ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´ ëª©ë¡ì…ë‹ˆë‹¤.
bot.project.select=í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.
bot.task.started=âš™ï¸ ì‘ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤...
bot.task.completed=âœ… ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!
bot.error.no_project=âš ï¸ ë¨¼ì € í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.
```

---

## 14. Docker ë°°í¬ ì„¤ì •

### 14.1 Dockerfile

```dockerfile
FROM eclipse-temurin:21-jre-alpine

WORKDIR /app

COPY target/claude-code-telegram-bot-*.jar app.jar

ENV JAVA_OPTS="-XX:+UseZGC -XX:+ZGenerational -Xmx512m"

EXPOSE 8080

ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
```

### 14.2 docker-compose.yml

```yaml
version: '3.8'

services:
  claude-bot:
    build: .
    container_name: claude-code-bot
    restart: unless-stopped
    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_BOT_USERNAME=${TELEGRAM_BOT_USERNAME}
      - DB_USERNAME=${DB_USERNAME}
      - DB_PASSWORD=${DB_PASSWORD}
      - SPRING_PROFILES_ACTIVE=prod
    volumes:
      - /home/potwings/workspace:/home/potwings/workspace
      - ./logs:/app/logs
    depends_on:
      - mysql
    networks:
      - claude-network

  mysql:
    image: mysql:8.0
    container_name: claude-bot-mysql
    restart: unless-stopped
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=claude_bot
      - MYSQL_USER=${DB_USERNAME}
      - MYSQL_PASSWORD=${DB_PASSWORD}
    volumes:
      - mysql-data:/var/lib/mysql
    networks:
      - claude-network

volumes:
  mysql-data:

networks:
  claude-network:
    driver: bridge
```

---

## 15. ê°œë°œ ì¼ì • (ìˆ˜ì •)

| Phase | ë‚´ìš© | ì˜ˆìƒ ê¸°ê°„ |
|-------|------|----------|
| **Phase 1** | í”„ë¡œì íŠ¸ ì…‹ì—… + ê¸°ë³¸ ë´‡ (start, help, í”„ë¡œì íŠ¸ ê´€ë¦¬) | 2ì¼ |
| **Phase 2** | Claude Code ì—°ë™ + ì‹¤ì‹œê°„ ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë° | 3ì¼ |
| **Phase 3** | ê²°ê³¼ í™•ì¸ (changes, diff, download) + ì¸ë¼ì¸ ë²„íŠ¼ | 2ì¼ |
| **Phase 4** | Git ì—°ë™ (commit, push, branch) | 2ì¼ |
| **Phase 5** | ì‚¬ìš©ì ì„¤ì • + ì—ëŸ¬ ì²˜ë¦¬ + í´ë¦¬ì‹± | 2ì¼ |
| **ì´ê³„** | | **11ì¼** |

---

ì´ PRDë¡œ ì§„í–‰í•˜ì‹œê² ì–´ìš”